# Copy workflow lockdown (revised)

- **Unexpected:** The build was still trying to serve `/encoding.js` even though the cleaned-up copy workflow only publishes `/core/browser` and `/core/*.js`, so browsers kept requesting resources that no longer exist when `/core/browser/data.js` stayed in place.
- **Diagnosis & options:** I followed the new requirement literally by rewriting `sharedDirectoryPairs`, the directory map in `src/build/path.js`, and `copyBrowserTrees` so that `src/browser` moves to `public/browser`, `src/core/browser` now lands in `public/core/browser`, and only the `.js` files directly under `src/core` get copied into `public/core`. Tests now assert the updated structure, the data module reimports `../encoding.js`, and I removed the temporary `src/core/core/encoding.js` helper since it was no longer needed.
- **Learning:** When tailoring a flat copy pipeline, keeping the published directory hierarchy as close to the imported relative paths as possible saved a lot of workâ€”moving `src/core/browser` into `public/core/browser` meant the existing `../encoding.js` import started resolving again without needing to keep `/encoding.js` around.
- **Follow-up:** The public bundle still contains the older helper under `public/core/copy.js`; whoever runs the generator next should update that file so it matches the new copy workflow instead of reintroducing the old paths.
