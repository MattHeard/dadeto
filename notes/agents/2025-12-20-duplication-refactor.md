## Duplication reductions for special inputs and variant handling

- **Unexpected:** jscpd kept flagging the handler dependency parameter lists in `mark-variant-dirty` and the `ensureSpecialInput` payload in the number/textarea handlersâ€”even though the surrounding logic was different, the repeated destructuring and object literal looked identical to the detector. It took a minute to realize the clone was happening purely because of the shared structure rather than any actual path duplication.
- **Options:** I could have left the code as-is and tuned the duplication threshold, but that would have left the duplication signal alive. Instead I pulled the handler dependencies outside of the `buildHandleRequest` signature so `processHandleRequest` receives the request data and the dependency bundle separately, eliminating the repeated destructuring block. For the input handlers, I introduced `createSpecialInputEnsurer` so the existing `selector/container/textInput/dom` wiring and `existingSpecialInput` caching live in one place while each handler only supplies its factory.
- **Learning & follow-up:** Sharing the handler dependency bundle this way also puts us in a good position to add more overrides without rewriting the builder, and the new ensurer helper can be extended if more widget types rely on the same insertion pattern. Next time a duplication report points to repeated destructuring or payload shapes, the first stop should be a shared helper that owns the repeated snippet instead of retyping it in each file.

**Open question:** Should we rerun `npm run duplication` now that both patterns are consolidated, or is that better left to the next agent when they tackle the remaining clone groups?
