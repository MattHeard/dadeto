<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Matt Heard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Sono:wght@200..800&display=swap"
      rel="stylesheet"
    />
    
    <!-- Define the component management system in the head -->
    <script type="module">
      // Define array of interactive components to initialize
      window.interactiveComponents = [];
      
      /**
       * Create a function that can add a component to the interactiveComponents list
       * This is defined in the head so it's available as soon as possible
       */
      const createComponentAdder = () => {
        /**
         * Add a component to the interactive components list
         * @param {string} id - The ID of the article element
         * @param {string} modulePath - Path to the module containing the processing function
         * @param {string} functionName - Name of the function to import from the module
         * @returns {Object} The component configuration that was added
         */
        return function addComponent(id, modulePath, functionName) {
          // Create the component configuration
          const component = {
            id,
            modulePath,
            functionName
          };
          
          // Add to the global list
          window.interactiveComponents.push(component);
          
          return component;
        };
      };
      
      // Create the component adder function and expose it globally
      window.addComponent = createComponentAdder();
    </script>
    <style>
      body {
        background-color: #121212;
        color: #cccccc;
        font-family: 'Sono', Consolas, monospace;
        font-size: 16px;
        line-height: 1.5;
        margin: 0;
        padding: 0;
      }
      #container {
        max-width: 85ch;
        padding: 1lh;
      }
      .entry {
        display: grid;
        grid-template-columns: 5ch auto;
        padding-bottom: 1em;
        gap: 0em 1em;
      }
      .key {
        font-weight: bold;
        color: #33ccff;
        text-align: right;
        padding: 0em 0em;
      }
      .value {
        text-align: left;
        color: #cccccc;
      }
      .article-title {
        color: #121212;
        background-color: #00ffff;
      }
      .media {
        color: #00ff00;
      }
      .footer {
        font-style: italic;
      }
      .full-width {
        white-space: nowrap;
        font-family: monospace;
        display: block;
        width: 100%;
        overflow: hidden;
        text-overflow: clip;
        line-height: 1;
        color: #00ffff;
      }

      h1,
      h2,
      h3 {
        color: #ffffff;
        font-size: 16px;
        margin: 0;
        text-transform: uppercase;
      }
      img {
        max-width: min(20em, 60vw);
        height: auto;
        display: block;
        filter: sepia(0.8) hue-rotate(151deg) saturate(2);
      }
      p {
        margin: 0;
      }
      ul,
      .related-links {
        margin: 0;
        padding-left: 0;
        list-style-type: none;
      }

      ul li::before,
      .related-links li::before {
        content: '- ';
        color: #33ccff;
      }
      a {
        color: #00ffff;
        text-decoration: none;
      }
      a:hover {
        color: #33ffff;
        text-decoration: underline;
      }
      h1 > a,
      h2 > a,
      h3 > a {
        color: #ffffff;
      }

      .warning {
        color: #ffa500;
      }
      .error {
        color: #ff0000;
      }
      .success {
        color: #00ff00;
      }
      .metadata {
        color: #33ccff;
      }

      code {
        background-color: #1a1a1a;
        color: #00ffff;
      }
      pre {
        background-color: #1a1a1a;
        color: #cccccc;
        padding: 10px;
        overflow-x: auto;
      }
      #audio-controls {
        background-color: #1a1a1a;
        color: #00ffff;
        display: inline-block;
      }
      .audio-btn {
        padding: 0em 1em;
        border: none;
        background: #00ff00;
        color: #1a1a1a;
        font-family: Consolas, monospace;
        cursor: pointer;
        height: 2em;
        margin-right: 1em;
      }
      .audio-btn:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <!-- Header -->
      <div class="entry">
        <div class="key"></div>
        <div class="value">
          <pre aria-label="Matt Heard" role="heading" aria-level="1">
▗▖  ▗▖ ▗▄▖▗▄▄▄▖▗▄▄▄▖      
▐▛▚▞▜▌▐▌ ▐▌ █    █        
▐▌  ▐▌▐▛▀▜▌ █    █        
▐▌  ▐▌▐▌ ▐▌ █    █        
▗▖ ▗▖▗▄▄▄▖ ▗▄▖ ▗▄▄▖ ▗▄▄▄  
▐▌ ▐▌▐▌   ▐▌ ▐▌▐▌ ▐▌▐▌  █ 
▐▛▀▜▌▐▛▀▀▘▐▛▀▜▌▐▛▀▚▖▐▌  █ 
▐▌ ▐▌▐▙▄▄▖▐▌ ▐▌▐▌ ▐▌▐▙▄▄▀
</pre
          >
        </div>
        <div class="key"></div>
        <div class="value metadata">
          Software developer and philosopher in Berlin
        </div>
      </div>
      <article class="entry" id="IDEN1">
        <div class="key full-width">▄▄▄▄▄▄▄▄▄▄</div>
        <div class="value full-width">
          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
        </div>

        <div class="key article-title">IDEN1</div>
        <div class="value">
          <h2><a href="#IDEN1">Identity</a></h2>
        </div>
        
        <div class="key">in</div>
        <div class="value">
          <form>
            <input type="text" disabled>
          </form>
        </div>
        
        <div class="key"></div>
        <div class="value">
          <button type="submit" disabled>Submit</button>
        </div>
        
        <div class="key">out</div>
        <div class="value warning">
          <p>This toy requires Javascript to run.</p>
        </div>
        
        <!-- Register this interactive component -->
        <script type="module">
          // Add this component to the list of components to be initialized
          window.addComponent('IDEN1', '/src/toys/2025-03-19/identity.js', 'identity');
        </script>

      </article>
      <div class="entry">
        <div class="key"></div>
        <div class="footer value warning">
          All content is authored by Matt Heard and is
          <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
            >CC BY-NC-SA 4.0</a
          >, unless otherwise noted.
        </div>
      </div>
    </div>
    <script>
      (function () {
        const audioElements = document.querySelectorAll('audio');

        audioElements.forEach(function (audio, index) {
          audio.removeAttribute('controls');

          if (!audio.id) {
            audio.id = 'audio-' + index;
          }

          const controlsContainer = document.createElement('div');
          controlsContainer.className = 'audio-controls';
          controlsContainer.id = 'controls-' + audio.id;

          const timeDisplay = document.createElement('span');
          timeDisplay.className = 'audio-time';
          timeDisplay.textContent = '0:00';

          const playButton = document.createElement('a');
          playButton.href = '#';
          playButton.className = 'audio-btn';
          playButton.textContent = 'PLAY';
          playButton.addEventListener('click', function (e) {
            e.preventDefault();
            audio.play();
          });

          const pauseButton = document.createElement('a');
          pauseButton.href = '#';
          pauseButton.className = 'audio-btn';
          pauseButton.textContent = 'PAUSE';
          pauseButton.addEventListener('click', function (e) {
            e.preventDefault();
            audio.pause();
          });

          const stopButton = document.createElement('a');
          stopButton.href = '#';
          stopButton.className = 'audio-btn';
          stopButton.textContent = 'STOP';
          stopButton.addEventListener('click', function (e) {
            e.preventDefault();
            audio.pause();
            audio.currentTime = 0;
          });

          audio.addEventListener('timeupdate', function () {
            const minutes = Math.floor(audio.currentTime / 60);
            const seconds = Math.floor(audio.currentTime % 60)
              .toString()
              .padStart(2, '0');
            timeDisplay.textContent = minutes + ':' + seconds;
          });

          controlsContainer.appendChild(playButton);
          controlsContainer.appendChild(pauseButton);
          controlsContainer.appendChild(stopButton);
          controlsContainer.appendChild(timeDisplay);

          audio.parentNode.insertBefore(controlsContainer, audio.nextSibling);
        });
      })();
    </script>
    
    <!-- Deferred loading of interactive components -->
    <script type="module">
      /**
       * Initialize an interactive component with a processing function
       * @param {string} id - The ID of the article element
       * @param {Function} processingFunction - The function to process input values
       */
      function initializeInteractiveComponent(id, processingFunction) {
        // Get the article element
        const article = document.getElementById(id);
        
        // Get the elements within the article
        const inputElement = article.querySelector('input');
        const submitButton = article.querySelector('button');
        const outputElement = article.querySelector('p');
        
        // Disable controls during initialization
        inputElement.disabled = true;
        submitButton.disabled = true;
        
        // Update message to show JS is running
        outputElement.textContent = 'Initialising...';
        
        /**
         * Enable controls and update status message
         */
        function enableControls() {
          inputElement.disabled = false;
          submitButton.disabled = false;
          outputElement.textContent = 'Ready for input';
          outputElement.parentElement.classList.remove('warning');
          // Focus the input field for immediate typing
          inputElement.focus();
        }
        
        /**
         * Handle form submission events
         * @param {Event} event - The submission event
         */
        function handleSubmit(event) {
          if (event) {
            event.preventDefault();
          }
          const inputValue = inputElement.value;
          
          // Use the provided processing function
          const result = processingFunction(inputValue);
          
          // Update the output
          outputElement.textContent = result;
        }
        
        // Add event listener to the submit button
        submitButton.addEventListener('click', handleSubmit);
        
        // Add event listener for Enter key in the input field
        inputElement.addEventListener('keypress', (event) => {
          if (event.key === 'Enter') {
            handleSubmit(event);
          }
        });
        
        // Enable controls when initialization is complete
        enableControls();
      }
      
      /**
       * Initialize a component when it enters the viewport
       * @param {string} id - The ID of the article element to observe
       * @param {string} modulePath - Path to the module containing the processing function
       * @param {string} functionName - Name of the function to import from the module
       */
      function initializeWhenVisible(id, modulePath, functionName) {
        const article = document.getElementById(id);
        
        // Create an observer instance
        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            // If the article is visible
            if (entry.isIntersecting) {
              // Dynamically import the module only when the article is visible
              import(modulePath).then((module) => {
                const processingFunction = module[functionName];
                
                // Initialize the component with the imported function
                initializeInteractiveComponent(id, processingFunction);
              }).catch(error => {
                console.error('Error loading module ' + modulePath + ':', error);
              });
              
              // Stop observing once initialized
              observer.disconnect();
            }
          });
        }, {
          // Options for the observer
          root: null, // viewport
          threshold: 0.1 // 10% visibility is enough to trigger
        });
        
        // Start observing the article
        observer.observe(article);
      }
      
      // Initialize all registered components when they become visible
      if (window.interactiveComponents && window.interactiveComponents.length > 0) {
        console.log('Initializing', window.interactiveComponents.length, 'interactive components');
        window.interactiveComponents.forEach(component => {
          initializeWhenVisible(component.id, component.modulePath, component.functionName);
        });
      } else {
        console.warn('No interactive components found to initialize');
      }
    </script>
  </body>
</html>
